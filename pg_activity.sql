CREATE OR REPLACE VIEW public.show_activity AS SELECT a.pid, a.client_addr, now() - a.query_start AS qtime, a.wait_event_type AS wait_type, a.datname, "left"(a.query, 120) AS query, now() - a.xact_start AS xtime FROM pg_stat_activity a WHERE a.state = 'active'::text AND a.client_addr IS NOT NULL UNION ALL SELECT a.pid, a.client_addr, now() - a.state_change AS qtime, a.wait_event_type AS wait_type, a.datname, '<IDLE> in transaction'::text AS query, now() - a.xact_start AS xtime FROM pg_stat_activity a WHERE (a.state = 'idle'::text OR a.state = 'idle in transaction'::text) AND a.xact_start IS NOT NULL AND a.client_addr IS NOT NULL ORDER BY 3 DESC;
